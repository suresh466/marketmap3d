# IMPORTANT: Only enable these after HTTPS is fully working!

# Clickjacking protection - prevents embedding in iframes
add_header X-Frame-Options "SAMEORIGIN" always;

# Prevent MIME type sniffing - forces browser to respect Content-Type
add_header X-Content-Type-Options "nosniff" always;

# Force HTTPS for 1 year - prevents downgrade attacks
# CAUTION: Once enabled, ALL subdomains must support HTTPS too
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
add_header Strict-Transport-Security "max-age=31536000" always;

# Referrer policy - controls what information is sent to other sites
# Same-origin: Full URL sent
# Cross-origin: Only origin sent (privacy)
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Permissions Policy - restricts browser features
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=()" always;

# Content Security Policy - CRITICAL for XSS protection
# This needs customization based on app
# Start with a basic policy and adjust as needed:
# add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; frame-ancestors 'self';" always;

# Content Security Policy (Tailored for Vite + MapLibre)
# add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://tiles.openfreemap.org; img-src 'self' data: https: blob:; font-src 'self' data:; connect-src 'self' https://tiles.openfreemap.org; worker-src 'self' blob:; frame-ancestors 'self';" always;
# BREAKDOWN:
# - default-src 'self': Only load resources from your domain by default
# - script-src: Allow your JS + inline scripts (Vite requirement) + eval (Turf.js uses it)
# - style-src: Your CSS + inline styles + OpenFreeMap styles
# - img-src: Your images + data URIs + HTTPS images + blobs (for map tiles)
# - connect-src: API calls to your server + OpenFreeMap tiles
# - worker-src: Web workers (MapLibre uses these) from your domain + blobs
# - frame-ancestors: Can only be framed by your domain
# NOTE: 'unsafe-inline' and 'unsafe-eval' weaken CSP but are required for:
# - Vite's development hot module replacement
# - Some Turf.js operations
# - MapLibre GL JS inline workers
# For maximum security, use CSP nonces in production (requires build changes)
